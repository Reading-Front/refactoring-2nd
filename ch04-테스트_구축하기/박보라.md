# Chapter 4: 테스트 구축하기  

> “테스트는 리팩터링의 토대다. 리팩터링을 시작하기 전에 견고한 테스트 스위트를 준비해야 한다.”  

## 목차  
- 테스트가 필요한 이유  
- 위험 기반 테스트  
- 테스트 작성 지침  
- TDD와 작은 단계  
- 마무리  

### 테스트가 필요한 이유  
리팩터링은 코드의 내부 구조를 개선하는 작업으로 외부 동작은 바꾸지 않는다. 이런 변경이 안전하려면 기존 기능이 깨지지 않는지 지속적으로 확인할 수 있어야 한다. 견고한 테스트 스위트가 리팩터링의 안전망 역할을 하며, 자동화된 테스트는 빠른 피드백을 제공한다. 컴파일 → 테스트 → 커밋 사이클을 반복하여 작업하는 것이 책에서 강조하는 핵심이다.  

### 위험 기반 테스트  
모든 함수를 테스트할 필요는 없다. 테스트를 너무 많이 작성하면 지치기 쉽기 때문에 위험이 높은 영역에 집중해야 한다. 코드가 복잡해지는 지점이나 오류 가능성이 높은 부분을 찾아 그 부분에 대한 테스트를 작성하고, 단순한 접근자 같은 부분은 제외할 수 있다. 리팩터링을 진행하면서 프로그램을 더 잘 이해하게 되므로 기존 테스트 스위트에 더해 필요할 때마다 새로운 테스트를 추가하는 것이 좋다.  

### 테스트 작성 지침  
테스트는 완전히 자동화되어야 하고, 실행할 때마다 스스로 결과를 확인해야 한다. 테스트는 자주 실행되어야 하므로 빠르게 돌아가야 하고, 실행 후 성공 여부를 명확히 알려줘야 한다. 다음과 같은 지침이 제시된다:  
- **테스트 상태를 격리하기**: 공용 변수를 사용해 테스트 간 상태가 공유되지 않도록 하고, 테스트 전에 `beforeEach` 같은 구성을 사용해 데이터를 초기화한다.  
- **녹색 막대에서만 리팩터링**: 테스트 스위트가 모두 통과한 상태(“녹색”)에서만 리팩터링을 진행하고, 실패하면 최근 변경을 되돌린 뒤 다시 시도한다.  
- **위험 중심**: 잠재적 결함이 있을 법한 부분을 우선적으로 다룬다.  
- **과테스팅을 피하기**: 너무 많은 테스트를 작성하면 코드 수정 시 테스트 수정에 더 많은 시간이 들 수 있다. 적절한 수준에서 테스트를 유지하되, 테스트 없이 리팩터링하지 않는다.  

### TDD와 작은 단계  
챕터 4에서는 테스트 주도 개발(TDD)을 권장한다. 이 방식은 실패하는 테스트를 먼저 작성하고, 가장 간단한 코드를 작성하여 테스트를 통과시키며, 그 후 코드를 정리하는 세 단계를 반복한다. 리팩터링을 할 때 작은 단계로 진행하며 매번 컴파일, 테스트, 커밋 사이클을 거치는 것이 중요하다. 또한 기능 추가와 리팩터링을 구분해 각각 다른 집중을 해야 한다.  

### 마무리  
‘테스트 구축하기’는 리팩터링 과정에서 테스트의 중요성을 강조한다. 견고하고 자동화된 테스트 스위트는 리팩터링의 안전망이며, 위험 기반 테스트를 통해 중요한 부분에 집중해야 한다. 테스트는 셀프 체킹이어야 하고, 언제나 녹색 막대에서만 리팩터링을 진행해야 한다. TDD와 작은 단계의 반복을 통해 안정적으로 리팩터링을 진행하면 기존 기능을 깨뜨리지 않으면서 내부 구조를 개선할 수 있다. 
